<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="stylesheet" href="css/mui.min.css">
    <link rel="stylesheet" href="css/home.css">
    <link rel="stylesheet" type="text/css" href="css/icons-extra.css" />
    <link rel="stylesheet" type="text/css" href="css/app.css" />
    <link rel="stylesheet" type="text/css" href="css/sports.css" />
    <link href="https://cdn.bootcss.com/bootstrap/4.1.1/css/bootstrap.min.css" rel="stylesheet">
    <title>俄罗斯VS沙特阿拉伯</title>
</head>
<style>
    .hide {
        display: none;
    }

    #myTab li {
        /* width: 30%; */
        font-size: 18px;
        list-style: none;
        /* text-align: center; */
        margin: auto;
    }

    #myTab li a {
        color: #333;
    }

    .game_1 {
        padding: 18px;
    }

    .quizzes-choice-item {
        width: 88px;
        height: 46px;
        border: 1px solid #93b76a;
        display: inline-block;
        background-color: #e4f3d5;
        border-radius: 8px;
    }

    .mt40 {
        margin-top: 40px;
    }

    .zhuangtai {
        width: 50px;
        display: inline-block;
        text-align: center;
        color: #fff;
    }

    .wait {

        background-color: red;
    }

    .success {
        background-color: green;
    }

    .tittle {
        line-height: 20px;
    }

    .win {
        text-align: center;
        font-size: 20px;
        width: 100%;
        color: red;
    }


    /* 遮罩 下注金额 */

    .theme-popover-mask {
        z-index: 9998;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: #000;
        opacity: 0.4;
        filter: alpha(opacity=40);
        display: none
    }

    .theme-popover {

        z-index: 9999;
        position: absolute;
        top: 49%;
        /* left: 89%; */
        width: 100%;
        height: 330px;
        /* margin: -180px 0 0 -330px; */
        border-radius: 5px;
        border: solid 2px #666;
        background-color: #fff;
        display: none;
        box-shadow: 0 0 10px #666;
    }

    .money {
        width: 88px;
        height: 26px;
        /* border-radius: 50%; */
        border: 1px solid gray;
        display: inline-block;
    }

    .game-quizz-items {
        padding-bottom: 0px;
        padding-top: 5px;
    }

    .game-quizz-items .mui-table-view-cell {
        padding-top: 10px;
        padding-bottom: 2px;
        font-size: 20px;
    }

    .game-quizz-item {
        width: 88px;
        /* border-radius: 50%; */
        border-left: 1px solid gray;
        display: inline-block
    }
</style>

<body>

    <header class="mui-bar mui-bar-nav aui-header b-line">
        <!--<a class=" mui-icon mui-icon-search mui-pull-left" href="search.html"></a>-->
        <a href="sports.html" class="a" style="line-height: 44px;">
            < </a>
                <h1 class="mui-title">赛事</h1>
    </header>

    <div class="mui-content">

        <div class="aui-hot t-line sports-line game-item">

        </div>

        <!--内容区-->
        <div class="aui-hot t-line sports-line" style="padding-top:0px;">
            <div class="mui-card mt16">
                <div class="mui-card-content">
                    <div class="mui-content " id="sport">

                        <!-- tab标签 -->
                        <ul id="myTab" class="nav nav-tabs" style="line-height: 20px; padding-bottom: 10px; padding-top:10px;">
                            <li>
                                <span class="mui-badge mui-badge-primary" style="width: 19px;height: 21px;padding:0px;">
                                    <img src="images/button/quiz_press@2x.png"></img>
                                </span>
                                <a href="#game-quizz" data-toggle="tab" class="active show">竞猜</a>
                            </li>

                            <li>
                                <span class="mui-badge mui-badge-primary" style="width: 19px;height: 21px;padding:0px;">
                                    <img src="images/button/mine_press@2x.png"></img>
                                </span>
                                <a href="#myself" data-toggle="tab">我的</a>
                            </li>
                            <li class="dropdown">
                                <span class="mui-badge mui-badge-primary" style="width: 19px;height: 21px;padding:0px;">
                                    <img src="images/button/friends@2x.png"></img>
                                </span>
                                <a href="#friends" data-toggle="tab">好友的</a>
                            </li>
                        </ul>

                        <!-- 每个tab页对应的内容 -->
                        <div id="myTabContent" class="tab-content">
                            <div class="tab-pane fade in active show" id="game-quizz">
                            </div>
                            <div class="tab-pane fade" id="myself">

                            </div>
                            <div class="tab-pane fade" id="friends">
                                <!-- 记录1 -->
                                <!--  
                                <div class="mui-card-content game_1">
                                    <div class="mui-content">
                                        <div class="tittle">
                                            <span class="zhuangtai wait">待开奖</span>
                                            <span class="result"> 胜 负 平</span>&nbsp;
                                            <i style="float:right;">06-12 11:00</i>
                                        </div>
                                        <div class="mui-row">
                                            <div class="mui-col-sm-4 mui-col-xs-4">
                                                <li class="mui-table-view-cell style_none">
                                                    <span class="quizzes-choice-item">
                                                        <p>我猜</p>
                                                        <p>德国胜</p>
                                                    </span>
                                                </li>
                                            </div>
                                            <div class="mui-col-sm-4 mui-col-xs-4">
                                                <li class="mui-table-view-cell style_none">
                                                    <span class="quizzes-choice-item">
                                                        <p>投注</p>
                                                        <p>100QB</p>
                                                    </span>
                                                </li>
                                            </div>
                                            <div class="mui-col-sm-4 mui-col-xs-4">
                                                <li class="mui-table-view-cell style_none">
                                                    <span class="quizzes-choice-item">
                                                        <p>赔率</p>
                                                        <p>1.85</p>
                                                    </span>
                                                </li>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            -->

                            </div>


                        </div>

                    </div>
                </div>

            </div>

        </div>
        <div class="theme-popover">
            <div class="theme-poptit">
                <a href="javascript:void(0);" title="关闭" class="close">×</a>
                <h5 id="game-quizz-item-name"></h5>
                <!-- <span style="float: right">投注规则 > </span> -->
            </div>
            <div class="theme-popbod dform">
                <div class="mui-row">
                    <div class="mui-col-sm-4 mui-col-xs-4">
                        <li class="mui-table-view-cell style_none p0 mui-active" quizzes-choice-item-bet="100">
                            <span class="money">
                                <p>100QB</p>
                            </span>
                        </li>
                    </div>
                    <div class="mui-col-sm-4 mui-col-xs-4">
                        <li class="mui-table-view-cell style_none p0" quizzes-choice-item-bet="200">
                            <span class="money">
                                <p>200QB</p>
                            </span>
                        </li>
                    </div>
                    <div class="mui-col-sm-4 mui-col-xs-4">
                        <li class="mui-table-view-cell style_none p0" quizzes-choice-item-bet="300">
                            <span class="money">
                                <p>300QB</p>
                            </span>
                        </li>
                    </div>

                    <div class="mui-col-sm-4 mui-col-xs-4">
                        <li class="mui-table-view-cell style_none p0" quizzes-choice-item-bet="500">
                            <span class="money">
                                <p>500QB</p>
                            </span>
                        </li>
                    </div>
                    <div class="mui-col-sm-4 mui-col-xs-4">
                        <li class="mui-table-view-cell style_none p0" quizzes-choice-item-bet="1000">
                            <span class="money">
                                <p>1000QB</p>
                            </span>
                        </li>
                    </div>
                    <div class="mui-col-sm-4 mui-col-xs-4">
                        <li class="mui-table-view-cell style_none p0" quizzes-choice-item-bet="2000">
                            <span class="money">
                                <p>2000QB</p>
                            </span>
                        </li>
                    </div>
                </div>
                <h5>赔率：
                    <span id="game-quizz-item-odds"></span>
                </h5>
                <h5>猜对获得：
                    <span id="game-quizz-item-reward"></span>
                </h5>
                <button type="button" class="mui-btn mui-btn-danger" style="width: 100%;border-radius: 0;" id="game-quizz-bet">立刻投注</button>
            </div>
        </div>
        <div class="theme-popover-mask"></div>

        <div class="mui-content" style="margin-top: 103px;">
            <button type="button" class="mui-btn mui-btn-danger" style="width: 49%;border-radius: 0;">与好友PK</button>
            <button type="button" class="mui-btn mui-btn-success " style="width: 49%;">分享给好友</button>
        </div>
    </div>

    <script type="text/javascript" src="https://ajax.aspnetcdn.com/ajax/jquery/jquery-3.3.1.min.js"></script>
    <script src="https://cdn.bootcss.com/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
    <script src="https://cdn.bootcss.com/bootstrap/4.1.1/js/bootstrap.min.js"></script>
    <script src="https://cdn.bootcss.com/mui/3.7.1/js/mui.min.js"></script>
    <script type="text/javascript" src="http://ajax.aspnetcdn.com/ajax/jquery.templates/beta1/jquery.tmpl.js"></script>


    <script id="game-item-tpl" type="text/x-jQuery-tmpl">

        <div class="mui-card mt16">
            <!--页眉，放置标题-->
            <div class="mui-card-header" style="padding-bottom:0px;padding-top:0px;">
                <div class="mui-card-header mui-card-media">
                    <span class="mui-badge mui-badge-primary" style="width: 78px;height: 50px;padding:0px;"> <img src="images/icon/67@2x.png"></img> </span>
                    <div class="mui-media-body" style="line-height: 50px;">
                        ${description}
                    </div>
                </div>
            </div>
            <!--内容区-->
            <div class="mui-card-content">
                <!-- <a href="#"><img src="images/thanos.png" alt=""></a> -->
                <div class="mui-content" style="border-top: 1px solid #ccc;">
                    <div class="mui-row">
                        <div class="mui-col-sm-4 mui-col-xs-4">
                            <li class="mui-table-view-cell style_none">
                                <span class="contury">
                                    <img src="${home_team.logo}" alt="">               
                                </span>
                                <span class="ing">${home_team.name}</span>
                            </li>
                        </div>
                        <div class="mui-col-sm-4 mui-col-xs-4">
                            <li class="mui-table-view-cell style_none p0">
                                {{if status == 0}}
                                <span class="time"  style="display: inline-block;">${begin}</span>
                                <span class="ing">竞猜中</span>
                                {{/if}}
                                {{if status == 1}}
                                <span class="time">${home_score} : ${visit_score}</span>
                                <span class="ing">比赛中</span>
                                {{/if}}
                                {{if status == 2}}
                                <span class="time">${home_score} : ${visit_score}</span>
                                <span class="ing">已结束</span>
                                {{/if}}
                            </li>
                        </div>
                        <div class="mui-col-sm-4 mui-col-xs-4">
                            <li class="mui-table-view-cell style_none">
                                <span class="contury">
                                    <img src="${visit_team.logo}" alt="">   
                                </span>
                                <span class="ing">${visit_team.name}</span>
                            </li>
                        </div>
                    </div>

                </div>
            </div>

        </div>
    </script>

    <script id="game-quizz-tpl" type="text/x-jQuery-tmpl">
        <div class="mui-card-content game_1" style="height:auto;">
            <div class="mui-content">
                <div class="tittle">
                    <span class="mui-badge mui-badge-primary" style="width: 19px;height: 21px;padding:0px;"> <img src="images/icon/ranking@2x.png"></img> </span>
                    <span class="result">${instruction}</span>&nbsp;
                    <i>( 90分钟内的赛果 )</i>
                </div>
                <div class="mui-row quizzes-choice-items" quizzes-id="${id}">
                   
                    {{each choice_opt}} 
                    <div class="mui-col-sm-4 mui-col-xs-4">
                        <li class="mui-table-view-cell style_none" style="padding-top:2px;padding-bottom:2px;">
                            <span class="quizzes-choice-item" quizzes-choice-item-name="${name}" 
                            quizzes-choice-item-odds="${odds}" quizzes-choice-item-id="${id}">
                                <p>${name}</p>
                                <p>${odds}</p>
                            </span>
                        </li>
                    </div>
                    {{/each}}
                </div>
            </div>
        </div>
    </script>


    <script id="game-quizz-my-tpl" type="text/x-jQuery-tmpl">        
        <!-- 记录1 -->
        <div class="mui-card-content game_1 game-quizz-items">
            <div class="mui-content" style="border-top: 1px solid #ccc; padding-top:5px;">
                <div class="tittle">
                    <span class="zhuangtai wait">待开奖</span>
                    <span class="result">${quizzes.instruction}</span>&nbsp;
                    <i style="float:right;"></i>
                </div>
                <div class="mui-row">
                    <div class="mui-col-sm-4 mui-col-xs-4">
                        <li class="mui-table-view-cell style_none">
                            <span class="game-quizz-item" style="border-left:0px;">
                                <p>我猜</p>
                                <p>${choice_opt.name}</p>
                            </span>
                        </li>
                    </div>
                    <div class="mui-col-sm-4 mui-col-xs-4">
                        <li class="mui-table-view-cell style_none">
                            <span class="game-quizz-item">
                                <p>投注</p>
                                <p>${money}QB</p>
                            </span>
                        </li>
                    </div>
                    <div class="mui-col-sm-4 mui-col-xs-4">
                        <li class="mui-table-view-cell style_none">
                            <span class="game-quizz-item">
                                <p>赔率</p>
                                <p>${choice_opt.odds}</p>
                            </span>
                        </li>
                    </div>
                </div>
                <!-- <div class="win">
                        获得185QB
                    </div>-->
            </div>
        </div>
    </script>
    <script>

        var getUrlParameter = function getUrlParameter(sParam) {
            var sPageURL = decodeURIComponent(window.location.search.substring(1)),
                sURLVariables = sPageURL.split('&'),
                sParameterName,
                i;

            for (i = 0; i < sURLVariables.length; i++) {
                sParameterName = sURLVariables[i].split('=');

                if (sParameterName[0] === sParam) {
                    return sParameterName[1] === undefined ? true : sParameterName[1];
                }
            }
        };

        jQuery(document).ready(function ($) {

            $('.theme-poptit .close').click(function () {
                $('.theme-popover-mask').fadeOut(100);
                $('.theme-popover').slideUp(200);
            })



            var game_id = getUrlParameter("game_id");
            game_id = parseInt(game_id)

            var choice_opt = {
                choice_id: 0,
                quizzes_id: 0,
                odds: 1,
                name: "",
                bet: 0,
            }

            var odds = 1;
            var name = "";
            $("#game-quizz").on("click", ".quizzes-choice-item", function () {
                choice_opt.name = $(this).attr("quizzes-choice-item-name");
                choice_opt.odds = $(this).attr("quizzes-choice-item-odds");
                choice_opt.choice_id = $(this).attr("quizzes-choice-item-id");

                choice_opt.quizzes_id = $(this).parents(".quizzes-choice-items").attr("quizzes-id");


                console.log($(this).parents(".quizzes-choice-items"))
                choice_opt.bet = 100;
                console.log(name, odds, choice_opt)

                $('#game-quizz-item-name').html("投注: " + choice_opt.name);
                $('#game-quizz-item-odds').html(choice_opt.odds);
                $('#game-quizz-item-reward').html(choice_opt.odds * choice_opt.bet + 'QB');

                $('.theme-popover-mask').fadeIn(100);
                $('.theme-popover').slideDown(200);
            })

            $(".mui-table-view-cell").click(function () {

                choice_opt.bet = $(this).attr("quizzes-choice-item-bet");

                $('#game-quizz-item-reward').html(choice_opt.odds * choice_opt.bet + 'QB');
            })


            $("#game-quizz-bet").click(function () {

                var user_id = parseInt($.cookie('user_id'));
                if (user_id == 0) {
                    alert("请登录");
                    window.location.href = "login.html";
                    return;
                }
                var params = {
                    game_id: game_id ? parseInt(game_id) : 0,
                    "auth_token": $.cookie('auth_token'),
                    "bet_amount": choice_opt.bet,
                    "choice_opt_id": parseInt(choice_opt.choice_id),
                    "quizzes_id": parseInt(choice_opt.quizzes_id),
                    "user_id": user_id
                };
                var url = "http://35.180.103.230:8080/v1/user/do_quizzes";

                console.log(params)
                $.ajax({
                    type: "POST",
                    url: url,
                    data: JSON.stringify(params),
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: function (res) {
                        console.log(res)

                        if (res.code == 200) {
                            alert('下注成功');

                            showMyQuizzesChoice(game_id)
                            $('.theme-popover-mask').fadeOut(100);
                            $('.theme-popover').slideUp(200);
                        } else if (res.code == 501) {
                            alert("请先登录");
                            window.location.href = "login.html"
                        } else {
                            alert(res.msg);
                        }
                    }
                });
            })

            function load() {
                var params = {
                    game_id: game_id ? parseInt(game_id) : 1
                };
                var url = "http://35.180.103.230:8080/v1/game/quizzes";

                $.ajax({
                    type: "POST",
                    url: url,
                    data: JSON.stringify(params),
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: function (res) {
                        console.log(res)
                        showGame(res.data.game)

                        showQuizzes(res.data.quizzes)
                    }
                });
            }


            function showMyQuizzesChoice(game_id) {
                var user_id = parseInt($.cookie('user_id'));

                var params = {
                    "auth_token": $.cookie('auth_token'),
                    "user_id": user_id,
                    "game_id": game_id,
                };
                var url = "http://35.180.103.230:8080/v1/user/quizzes_list";

                $.ajax({
                    type: "POST",
                    url: url,
                    data: JSON.stringify(params),
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: function (res) {
                        console.log(res)

                        if (res.code == 200 && res.data.length > 0) {
                            $("#game-quizz-my-tpl").tmpl(res.data[0].quizzes).appendTo("#myself");
                        }

                    }
                });
            }

            function showGame(game) {

                document.title = game.home_team.name + 'VS' + game.visit_team.name;

                $("#game-item-tpl").tmpl(game).appendTo(".game-item");
            }

            function showQuizzes(quizzes) {
                $("#game-quizz-tpl").tmpl(quizzes).appendTo("#game-quizz");
            }

            $('#which').click(function () {
                $('.theme-popover-mask').fadeIn(100);
                $('.theme-popover').slideDown(200);
            })
            $('.theme-poptit .close').click(function () {
                $('.theme-popover-mask').fadeOut(100);
                $('.theme-popover').slideUp(200);
            })

            load()
            showMyQuizzesChoice(game_id)
        })


    </script>
</body>

</html>